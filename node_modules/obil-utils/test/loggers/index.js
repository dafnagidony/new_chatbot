var logger = require('../..').logger;
var test = require('tape');

test('Logger', {skip: false}, (t) => {
  t.test('sink stdout', {skip: false}, (tt) => {
    var log;
    tt.throws(() => {
      logger.create();
    }, TypeError, 'throws type error');
    logger.createOBSinks('type', 'owner');
    log = logger.create('obil.server');
    log.info('foo', {some_var: 'value'});
    log.error('bar', {other_var: 'othervalue'});
    log.crit('baz');
    tt.end();
  });

  t.test('sink-logstash', {skip: false}, (tt) => {
    var log;

    tt.test('create client', {skip: false}, (ttt) => {
      logger.createOBSinks('type', 'owner', {
        port: 55414,
        sink: 'logstash'
      });
      log = logger.create('test.console', {
        sink: 'console'
      });
      ttt.end();
    });

    tt.test('obil-sink-logstash', {skip: false}, (ttt) => {
      log.info('just a log', {test: 'foobar'});
      ttt.end();
    });
  });
});
