var test = require('tape');
var path = require('path');
var module = require('../../..');
var ormStore = module.store.orm;

test('ORM', {skip: false}, function(t) {
  t.test('connect', function(tt) {
    var db;
    tt.test('returns instance of orm', function(ttt) {
      const conf = {
        protocol: 'sqlite',
        database: path.resolve(__dirname, '../../fixtures/store/orm/test.db'),
        // example of conf. for mysql
        // hostname: '127.0.0.1',
        // port: 3306,
        // user: 'anontxt',
        // password: 'anontxt',
        // database: 'test',
        query: {
          debug: true
        }
      };
      ttt.plan(1);
      ormStore.connect(conf).then(function(d) {
        db = d;
        ttt.ok(db.driver.dialect === 'sqlite');
      });
    });
    tt.test('close connection', function(ttt) {
      db.close(function() {
        ttt.pass();
        ttt.end();
      });
    });
    tt.end();
  });
  t.end();
});
