/**
 * errorHandler
 * Alternates response message with error stack
 * and status code
 */
module.exports = function errorHandler() {
  return function errorHandlerPlugin(err, req, res, next) {
    var status = err.errorCode || err.status || err.statusCode || 500;
    if (status < 400) {
      status = 500;
    }
    res.statusCode = status;
    err.status = status;
    if (status >= 500) {
      res.statusMessage = JSON.stringify(err.stack);
    }
    next(err);
  };
};
